<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Stok Bahan Ajar - SITTA UT</title>
    <script src="https://cdn.tailwindcss.com"></script>
  </head>
  <body class="bg-gray-50">
    <div id="app" class="min-h-screen py-8">
      <div class="max-w-7xl mx-auto px-4">
        <header class="mb-6 flex justify-between items-center">
          <h1 class="text-3xl font-bold text-gray-800">
            üì¶ Stok Bahan Ajar UT
          </h1>
          <a
            href="index.html"
            class="bg-gray-600 text-white px-4 py-2 rounded-lg hover:bg-gray-700 transition"
          >
            ‚Üê Kembali ke Menu
          </a>
        </header>

        <!-- Filter Section -->
        <div class="bg-white rounded-lg shadow-md p-6 mb-6">
          <h3 class="text-xl font-semibold text-gray-800 mb-4">
            Filter & Sort Data
          </h3>

          <div class="grid md:grid-cols-3 gap-4 mb-4">
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2"
                >UT Daerah:</label
              >
              <select
                v-model="filterUpbjj"
                class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent"
              >
                <option value="">Semua UT Daerah</option>
                <option v-for="upbjj in upbjjList" :key="upbjj" :value="upbjj">
                  {{ upbjj }}
                </option>
              </select>
            </div>

            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2"
                >Kategori:</label
              >
              <select
                v-model="filterKategori"
                :disabled="!filterUpbjj"
                class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent disabled:bg-gray-100 disabled:cursor-not-allowed"
              >
                <option value="">Semua Kategori</option>
                <option
                  v-for="kat in availableKategori"
                  :key="kat"
                  :value="kat"
                >
                  {{ kat }}
                </option>
              </select>
            </div>

            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2"
                >Urutkan:</label
              >
              <select
                v-model="sortBy"
                class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent"
              >
                <option value="">Tidak Diurutkan</option>
                <option value="judul">Judul (A-Z)</option>
                <option value="qty">Stok (Terendah-Tertinggi)</option>
                <option value="harga">Harga (Terendah-Tertinggi)</option>
              </select>
            </div>
          </div>

          <div class="flex justify-between items-center">
            <label class="flex items-center space-x-2 cursor-pointer">
              <input
                type="checkbox"
                v-model="showReorderOnly"
                class="w-4 h-4 text-blue-600 rounded focus:ring-blue-500"
              />
              <span class="text-sm text-gray-700"
                >Tampilkan Perlu Re-order (Stok &lt; Safety atau Kosong)</span
              >
            </label>
            <button
              @click="resetFilters"
              class="bg-gray-500 text-white px-4 py-2 rounded-lg hover:bg-gray-600 transition"
            >
              Reset Filter
            </button>
          </div>
        </div>

        <!-- Summary -->
        <div class="bg-blue-50 border border-blue-200 rounded-lg p-4 mb-4">
          <p class="text-blue-800">
            Menampilkan <strong>{{ filteredStok.length }}</strong> dari
            <strong>{{ stok.length }}</strong> data bahan ajar
          </p>
        </div>

        <!-- Add New Stock Button -->
        <button
          @click="showAddForm = !showAddForm"
          class="bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700 transition mb-6 font-medium"
        >
          {{ showAddForm ? '‚úï Tutup Form' : '+ Tambah Bahan Ajar Baru' }}
        </button>

        <!-- Add Form -->
        <div v-if="showAddForm" class="bg-white rounded-lg shadow-md p-6 mb-6">
          <h3 class="text-xl font-semibold text-gray-800 mb-4">
            Tambah Bahan Ajar Baru
          </h3>
          <form @submit.prevent="addNewStock">
            <div class="grid md:grid-cols-2 gap-4">
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2"
                  >Kode Mata Kuliah*:</label
                >
                <input
                  type="text"
                  v-model="newStock.kode"
                  required
                  placeholder="Contoh: EKMA4116"
                  class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                />
                <span v-if="validationErrors.kode" class="text-red-600 text-sm"
                  >{{ validationErrors.kode }}</span
                >
              </div>

              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2"
                  >Nama Mata Kuliah*:</label
                >
                <input
                  type="text"
                  v-model="newStock.judul"
                  required
                  placeholder="Contoh: Pengantar Manajemen"
                  class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                />
                <span v-if="validationErrors.judul" class="text-red-600 text-sm"
                  >{{ validationErrors.judul }}</span
                >
              </div>

              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2"
                  >Kategori*:</label
                >
                <select
                  v-model="newStock.kategori"
                  required
                  class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                >
                  <option value="">Pilih Kategori</option>
                  <option v-for="kat in kategoriList" :key="kat" :value="kat">
                    {{ kat }}
                  </option>
                </select>
              </div>

              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2"
                  >UT Daerah*:</label
                >
                <select
                  v-model="newStock.upbjj"
                  required
                  class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                >
                  <option value="">Pilih UT Daerah</option>
                  <option
                    v-for="upbjj in upbjjList"
                    :key="upbjj"
                    :value="upbjj"
                  >
                    {{ upbjj }}
                  </option>
                </select>
              </div>

              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2"
                  >Lokasi Rak*:</label
                >
                <input
                  type="text"
                  v-model="newStock.lokasiRak"
                  required
                  placeholder="Contoh: R1-A3"
                  class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                />
              </div>

              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2"
                  >Harga*:</label
                >
                <input
                  type="number"
                  v-model.number="newStock.harga"
                  required
                  min="0"
                  placeholder="60000"
                  class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                />
              </div>

              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2"
                  >Jumlah Stok*:</label
                >
                <input
                  type="number"
                  v-model.number="newStock.qty"
                  required
                  min="0"
                  placeholder="20"
                  class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                />
              </div>

              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2"
                  >Safety Stock*:</label
                >
                <input
                  type="number"
                  v-model.number="newStock.safety"
                  required
                  min="0"
                  placeholder="10"
                  class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                />
              </div>

              <div class="md:col-span-2">
                <label class="block text-sm font-medium text-gray-700 mb-2"
                  >Catatan (HTML):</label
                >
                <input
                  type="text"
                  v-model="newStock.catatanHTML"
                  placeholder="<em>Catatan tambahan</em>"
                  class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                />
              </div>
            </div>

            <div class="flex gap-3 mt-6">
              <button
                type="submit"
                class="bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700 transition"
              >
                Simpan
              </button>
              <button
                type="button"
                @click="cancelAdd"
                class="bg-gray-500 text-white px-6 py-2 rounded-lg hover:bg-gray-600 transition"
              >
                Batal
              </button>
            </div>
          </form>
        </div>

        <!-- Edit Form -->
        <div
          v-if="editingIndex !== null"
          class="bg-white rounded-lg shadow-md p-6 mb-6 border-2 border-yellow-500"
        >
          <h3 class="text-xl font-semibold text-gray-800 mb-4">
            Edit Bahan Ajar
          </h3>
          <form @submit.prevent="saveEdit">
            <div class="grid md:grid-cols-2 gap-4">
              <div class="md:col-span-2">
                <label class="block text-sm font-medium text-gray-700 mb-2"
                  >Kode: <strong>{{ editStock.kode }}</strong></label
                >
              </div>

              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2"
                  >Judul:</label
                >
                <input
                  type="text"
                  v-model="editStock.judul"
                  required
                  class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                />
              </div>

              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2"
                  >Kategori:</label
                >
                <select
                  v-model="editStock.kategori"
                  required
                  class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                >
                  <option v-for="kat in kategoriList" :key="kat" :value="kat">
                    {{ kat }}
                  </option>
                </select>
              </div>

              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2"
                  >UT Daerah:</label
                >
                <select
                  v-model="editStock.upbjj"
                  required
                  class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                >
                  <option
                    v-for="upbjj in upbjjList"
                    :key="upbjj"
                    :value="upbjj"
                  >
                    {{ upbjj }}
                  </option>
                </select>
              </div>

              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2"
                  >Lokasi Rak:</label
                >
                <input
                  type="text"
                  v-model="editStock.lokasiRak"
                  required
                  class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                />
              </div>

              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2"
                  >Harga:</label
                >
                <input
                  type="number"
                  v-model.number="editStock.harga"
                  required
                  min="0"
                  class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                />
              </div>

              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2"
                  >Jumlah Stok:</label
                >
                <input
                  type="number"
                  v-model.number="editStock.qty"
                  required
                  min="0"
                  class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                />
              </div>

              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2"
                  >Safety Stock:</label
                >
                <input
                  type="number"
                  v-model.number="editStock.safety"
                  required
                  min="0"
                  class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                />
              </div>

              <div class="md:col-span-2">
                <label class="block text-sm font-medium text-gray-700 mb-2"
                  >Catatan:</label
                >
                <input
                  type="text"
                  v-model="editStock.catatanHTML"
                  class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                />
              </div>
            </div>

            <div class="flex gap-3 mt-6">
              <button
                type="submit"
                class="bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700 transition"
              >
                Update
              </button>
              <button
                type="button"
                @click="cancelEdit"
                class="bg-gray-500 text-white px-6 py-2 rounded-lg hover:bg-gray-600 transition"
              >
                Batal
              </button>
            </div>
          </form>
        </div>

        <!-- Stock Table -->
        <div class="bg-white rounded-lg shadow-md overflow-hidden">
          <div v-if="filteredStok.length > 0" class="overflow-x-auto">
            <table class="w-full">
              <thead class="bg-gray-100 border-b">
                <tr>
                  <th
                    class="px-4 py-3 text-left text-sm font-semibold text-gray-700"
                  >
                    Kode
                  </th>
                  <th
                    class="px-4 py-3 text-left text-sm font-semibold text-gray-700"
                  >
                    Nama Mata Kuliah
                  </th>
                  <th
                    class="px-4 py-3 text-left text-sm font-semibold text-gray-700"
                  >
                    Kategori
                  </th>
                  <th
                    class="px-4 py-3 text-left text-sm font-semibold text-gray-700"
                  >
                    UT Daerah
                  </th>
                  <th
                    class="px-4 py-3 text-left text-sm font-semibold text-gray-700"
                  >
                    Lokasi Rak
                  </th>
                  <th
                    class="px-4 py-3 text-left text-sm font-semibold text-gray-700"
                  >
                    Harga
                  </th>
                  <th
                    class="px-4 py-3 text-center text-sm font-semibold text-gray-700"
                  >
                    Stok
                  </th>
                  <th
                    class="px-4 py-3 text-center text-sm font-semibold text-gray-700"
                  >
                    Safety
                  </th>
                  <th
                    class="px-4 py-3 text-center text-sm font-semibold text-gray-700"
                  >
                    Status
                  </th>
                  <th
                    class="px-4 py-3 text-left text-sm font-semibold text-gray-700"
                  >
                    Catatan
                  </th>
                  <th
                    class="px-4 py-3 text-center text-sm font-semibold text-gray-700"
                  >
                    Aksi
                  </th>
                </tr>
              </thead>
              <tbody class="divide-y divide-gray-200">
                <tr
                  v-for="(item, index) in filteredStok"
                  :key="item.kode"
                  class="hover:bg-gray-50"
                >
                  <td class="px-4 py-3 text-sm font-medium text-gray-900">
                    {{ item.kode }}
                  </td>
                  <td class="px-4 py-3 text-sm text-gray-700">
                    {{ item.judul }}
                  </td>
                  <td class="px-4 py-3 text-sm text-gray-700">
                    {{ item.kategori }}
                  </td>
                  <td class="px-4 py-3 text-sm text-gray-700">
                    {{ item.upbjj }}
                  </td>
                  <td class="px-4 py-3 text-sm text-gray-700">
                    {{ item.lokasiRak }}
                  </td>
                  <td class="px-4 py-3 text-sm text-gray-700">
                    Rp {{ formatPrice(item.harga) }}
                  </td>
                  <td class="px-4 py-3 text-sm text-center font-medium">
                    {{ item.qty }}
                  </td>
                  <td class="px-4 py-3 text-sm text-center font-medium">
                    {{ item.safety }}
                  </td>
                  <td class="px-4 py-3 text-center">
                    <span
                      v-if="item.qty === 0"
                      class="inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-red-100 text-red-800"
                    >
                      ‚õî Kosong
                    </span>
                    <span
                      v-else-if="item.qty < item.safety"
                      class="inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800"
                    >
                      ‚ö†Ô∏è Menipis
                    </span>
                    <span
                      v-else
                      class="inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800"
                    >
                      ‚úÖ Aman
                    </span>
                  </td>
                  <td class="px-4 py-3 text-sm text-gray-700">
                    <span v-html="item.catatanHTML"></span>
                  </td>
                  <td class="px-4 py-3 text-center">
                    <button
                      @click="startEdit(getOriginalIndex(item))"
                      class="bg-yellow-500 text-white px-3 py-1 rounded hover:bg-yellow-600 transition text-sm"
                    >
                      ‚úèÔ∏è Edit
                    </button>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
          <div v-else class="p-8 text-center text-gray-500">
            <p>Tidak ada data yang sesuai dengan filter</p>
          </div>
        </div>
      </div>
    </div>

    <script src="https://unpkg.com/vue@3.5.25/dist/vue.global.js"></script>
    <script type="module" src="./src/js/stok-app.js"></script>
  </body>
</html>
