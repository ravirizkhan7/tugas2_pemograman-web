<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Tracking Delivery Order - SITTA UT</title>
    <script src="https://cdn.tailwindcss.com"></script>
  </head>
  <body class="bg-gray-50">
    <div id="app" class="min-h-screen py-8">
      <div class="max-w-7xl mx-auto px-4">
        <header class="mb-6 flex justify-between items-center">
          <h1 class="text-3xl font-bold text-gray-800">
            üöö Tracking Delivery Order
          </h1>
          <a
            href="index.html"
            class="bg-gray-600 text-white px-4 py-2 rounded-lg hover:bg-gray-700 transition"
          >
            ‚Üê Kembali ke Menu
          </a>
        </header>

        <!-- Add New DO Button -->
        <button
          @click="showAddForm = !showAddForm"
          class="bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700 transition mb-6 font-medium"
        >
          {{ showAddForm ? '‚úï Tutup Form' : '+ Tambah Delivery Order Baru' }}
        </button>

        <!-- Add DO Form -->
        <div v-if="showAddForm" class="bg-white rounded-lg shadow-md p-6 mb-6">
          <h3 class="text-xl font-semibold text-gray-800 mb-4">
            Form Delivery Order Baru
          </h3>
          <form @submit.prevent="addNewDO">
            <div class="grid md:grid-cols-2 gap-4">
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2"
                  >Nomor DO (Auto Generate):</label
                >
                <input
                  type="text"
                  :value="generateDONumber"
                  readonly
                  class="w-full border border-gray-300 rounded-lg px-3 py-2 bg-gray-100 font-mono font-semibold text-blue-600"
                />
              </div>

              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2"
                  >NIM*:</label
                >
                <input
                  type="text"
                  v-model="newDO.nim"
                  required
                  placeholder="Contoh: 123456789"
                  pattern="[0-9]{9}"
                  class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                />
                <span class="text-xs text-gray-500">Format: 9 digit angka</span>
              </div>

              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2"
                  >Nama*:</label
                >
                <input
                  type="text"
                  v-model="newDO.nama"
                  required
                  placeholder="Nama Lengkap"
                  class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                />
              </div>

              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2"
                  >Ekspedisi*:</label
                >
                <select
                  v-model="newDO.ekspedisi"
                  required
                  class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                >
                  <option value="">Pilih Ekspedisi</option>
                  <option
                    v-for="eks in pengirimanList"
                    :key="eks.kode"
                    :value="eks.kode"
                  >
                    {{ eks.nama }}
                  </option>
                </select>
              </div>

              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2"
                  >Paket Bahan Ajar*:</label
                >
                <select
                  v-model="newDO.paketKode"
                  required
                  class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                >
                  <option value="">Pilih Paket</option>
                  <option
                    v-for="pkt in paket"
                    :key="pkt.kode"
                    :value="pkt.kode"
                  >
                    {{ pkt.kode }} - {{ pkt.nama }}
                  </option>
                </select>
              </div>

              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2"
                  >Tanggal Kirim*:</label
                >
                <input
                  type="date"
                  v-model="newDO.tanggalKirim"
                  required
                  class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                />
              </div>

              <!-- Detail Paket yang dipilih -->
              <div
                v-if="selectedPaket"
                class="md:col-span-2 bg-blue-50 border border-blue-200 rounded-lg p-4"
              >
                <h4 class="font-semibold text-blue-900 mb-2">
                  üì¶ Detail Paket:
                </h4>
                <div class="grid md:grid-cols-3 gap-3">
                  <div>
                    <p class="text-xs text-blue-600 font-medium">Nama Paket</p>
                    <p class="text-sm text-blue-800 font-semibold">
                      {{ selectedPaket.nama }}
                    </p>
                  </div>
                  <div>
                    <p class="text-xs text-blue-600 font-medium">Isi Paket</p>
                    <p class="text-sm text-blue-800">
                      {{ selectedPaket.isi.join(', ') }}
                    </p>
                  </div>
                  <div>
                    <p class="text-xs text-blue-600 font-medium">Total Harga</p>
                    <p class="text-sm text-blue-800 font-bold">
                      Rp {{ formatPrice(selectedPaket.harga) }}
                    </p>
                  </div>
                </div>
              </div>
            </div>

            <div class="flex gap-3 mt-6">
              <button
                type="submit"
                class="bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700 transition"
              >
                üíæ Simpan DO
              </button>
              <button
                type="button"
                @click="cancelAdd"
                class="bg-gray-500 text-white px-6 py-2 rounded-lg hover:bg-gray-600 transition"
              >
                Batal
              </button>
            </div>
          </form>
        </div>

        <!-- Tracking List -->
        <div class="space-y-4">
          <div class="flex justify-between items-center">
            <h3 class="text-xl font-semibold text-gray-800">
              üìã Daftar Delivery Order
            </h3>
            <span class="text-sm text-gray-600"
              >Total: <strong>{{ trackingListArray.length }}</strong> DO</span
            >
          </div>

          <div
            v-if="trackingListArray.length === 0"
            class="bg-white rounded-lg shadow-md p-8 text-center text-gray-500"
          >
            <div class="text-6xl mb-4">üì¶</div>
            <p class="text-lg font-medium">Belum ada data tracking</p>
            <p class="text-sm">Silakan tambahkan Delivery Order baru</p>
          </div>

          <div
            v-for="item in trackingListArray"
            :key="item.doNumber"
            class="bg-white rounded-lg shadow-md overflow-hidden"
          >
            <div
              class="bg-gradient-to-r from-blue-600 to-blue-700 p-4 text-white"
            >
              <div class="flex justify-between items-center">
                <div>
                  <h4 class="text-lg font-bold">{{ item.doNumber }}</h4>
                  <p class="text-sm opacity-90">
                    {{ item.nama }} (NIM: {{ item.nim }})
                  </p>
                </div>
                <span
                  class="bg-white text-blue-700 px-4 py-2 rounded-full font-semibold text-sm"
                >
                  {{ item.status }}
                </span>
              </div>
            </div>

            <div class="p-6">
              <div class="grid md:grid-cols-2 gap-4 mb-6">
                <div>
                  <p class="text-xs text-gray-500 mb-1">Ekspedisi</p>
                  <p class="font-semibold text-gray-800">
                    {{ getEkspedisiName(item.ekspedisi) }}
                  </p>
                </div>
                <div>
                  <p class="text-xs text-gray-500 mb-1">Tanggal Kirim</p>
                  <p class="font-semibold text-gray-800">
                    {{ formatDate(item.tanggalKirim) }}
                  </p>
                </div>
                <div>
                  <p class="text-xs text-gray-500 mb-1">Paket</p>
                  <p class="font-semibold text-gray-800">
                    {{ getPaketName(item.paket) }}
                  </p>
                </div>
                <div>
                  <p class="text-xs text-gray-500 mb-1">Total Harga</p>
                  <p class="font-semibold text-gray-800">
                    Rp {{ formatPrice(item.total) }}
                  </p>
                </div>
              </div>

              <!-- Timeline Perjalanan -->
              <div v-if="item.perjalanan && item.perjalanan.length > 0">
                <h5
                  class="font-semibold text-gray-800 mb-3 flex items-center gap-2"
                >
                  <span>üìç</span> Riwayat Perjalanan
                </h5>
                <div class="space-y-3">
                  <div
                    v-for="(step, index) in item.perjalanan"
                    :key="index"
                    class="flex gap-3"
                  >
                    <div class="flex flex-col items-center">
                      <div
                        class="w-3 h-3 bg-blue-600 rounded-full"
                        :class="{ 'animate-pulse': index === item.perjalanan.length - 1 }"
                      ></div>
                      <div
                        v-if="index < item.perjalanan.length - 1"
                        class="w-0.5 h-full bg-blue-300 mt-1"
                      ></div>
                    </div>
                    <div class="flex-1 pb-4">
                      <p class="text-xs text-gray-500 mb-0.5">
                        {{ step.waktu }}
                      </p>
                      <p class="text-sm text-gray-800 font-medium">
                        {{ step.keterangan }}
                      </p>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script src="https://unpkg.com/vue@3.5.25/dist/vue.global.js"></script>
    <script type="module" src="src/js/tracking-app.js"></script>
  </body>
</html>
